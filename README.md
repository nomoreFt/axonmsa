# axonmsa

Command: 사용자가 주문 버튼을 클릭하면, 서버에 "CreateOrderCommand"가 전송됩니다. 이 커맨드는 주문을 생성하라는 명령입니다.

Aggregate: 주문 관련 비즈니스 로직을 담당하는 주문 Aggregate는 이 커맨드를 받아 처리합니다. Aggregate는 주문 생성과 관련된 유효성 검사 등의 비즈니스 로직을 수행한 후 주문이 생성되었다는 이벤트를 발행합니다.

Event: Aggregate에서 발행한 "OrderCreatedEvent"는 이벤트 스토어에 저장되며, 이 이벤트는 주문이 성공적으로 생성되었음을 알립니다. 이 이벤트는 후속 처리를 위해 다른 서비스나 컴포넌트에게 전달될 수 있습니다.

Projection (View Model): 주문에 대한 요약 정보를 제공하는 주문 요약 뷰 모델 (Projection)은 "OrderCreatedEvent"를 받아 주문 요약 정보를 업데이트합니다. 주문 요약 뷰 모델은 주문 정보를 저장하고, 필요에 따라 사용자에게 보여주는 데 사용됩니다.

Emitter: 사용자는 웹 페이지에서 주문의 진행 상태를 실시간으로 확인하고 싶어합니다. 이 때 QueryUpdateEmitter가 활용됩니다. 주문 요약 뷰 모델은 주문 정보가 업데이트되었음을 QueryUpdateEmitter에게 알리고, QueryUpdateEmitter는 이 정보를 사용자에게 실시간으로 전달합니다. 이를 통해 사용자는 웹 페이지를 새로고침하지 않고도 주문의 진행 상태를 실시간으로 확인할 수 있습니다.

즉, Command는 액션을 시작하고, Aggregate는 액션을 처리하고, Event는 액션이 처리되었음을 알리며, Projection은 이벤트를 바탕으로 뷰 모델을 업데이트하고, Emitter는 이 업데이트를 실시간으로 사용자에게 전달하는 역할을 합니다.





# 실행 순서

1. 컨트롤러에서 커맨드 발생: 컨트롤러는 사용자의 요청에 대한 처리를 시작합니다. 이 때 사용자의 요청을 담당하는 커맨드가 만들어지고, 이를 처리하기 위해 commandGateway를 통해 커맨드가 발행됩니다.

2. Aggregate에서 커맨드 처리: commandGateway는 커맨드를 받아들이고 적절한 Aggregate(도메인 객체)에게 전달합니다. Aggregate는 커맨드를 처리하고, 이에 따른 도메인 로직을 수행합니다.

3. 이벤트 발생: 커맨드 처리 결과에 따라 도메인 상태가 변경되면, 이를 반영하는 이벤트가 발생합니다. 이 이벤트는 상태 변화를 나타내며, 이를 다른 컴포넌트에게 알리는 역할을 합니다.

4. 이벤트 처리: 이벤트는 이벤트 핸들러에 의해 처리됩니다. 이벤트 핸들러는 Projection(프로젝션)에 위치할 수 있으며, 발생한 이벤트를 받아 Query 모델을 업데이트하는 역할을 합니다.

5. Query 발행: 업데이트된 Query 모델에 대한 정보가 필요한 경우, 서비스 레이어에서 queryGateway를 통해 Query를 발행합니다. Query는 일반적으로 조회를 위한 작업을 담당하며, 발행된 Query는 QueryHandler에 의해 처리됩니다.

6. QueryHandler에서 Query 처리: QueryHandler는 특정 Query를 처리하는 로직을 포함하고 있습니다. 이 핸들러는 Query가 발행되면 호출되며, Query에 따라 필요한 데이터를 조회하거나 연산을 수행합니다.

7. 이처럼 커맨드와 이벤트, 그리고 쿼리는 시스템 내의 데이터 흐름과 상태 변경을 관리하는 핵심 요소입니다. 이들은 CQRS와 이벤트 소싱 패턴에서 중요한 역할을 수행하며, 복잡한 비즈니스 로직과 도메인 상태를 관리하는 데 필요한 도구입니다.